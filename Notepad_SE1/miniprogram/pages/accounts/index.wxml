<view>
  <view class="topBar" style="display: flex;text-align: left;">

    <view style="font-size: 45rpx;margin-top: 20rpx;margin-left: 20rpx;">{{(emptyDatabase||!haveGetOpenId)?"^_^":"日期"}}
      <picker value="{{yearsIdx}}" range="{{years}}" bindchange="bindPickerChange"
        style="font-size: 50rpx; width: 180rpx; height: 106rpx;font-weight: 500; ">
        {{years[yearsIdx]}}</picker>
    </view>
    <view
      style="margin-left: 10%; font-size: 30rpx; margin-top: 55rpx; width: 158rpx; height: 141rpx; display: block; box-sizing: border-box; left: NaNrpx; top: NaNrpx">
      <text>本日支出\n{{dayCost}}¥</text>
    </view>
    <view style="margin-left: 10%;font-size:30rpx;margin-top:55rpx"><text>本日收入\n{{dayIncome}}¥</text></view>

  </view>
  <view class="topBar">
    <mp-sticky offset-top="16">
      <button size="mini" type="primary" style="margin:0 290rpx; background-color: #008F7A"
        bindtap="writeABillPopup">{{haveGetOpenId?"记一笔":"登录"}}</button>
    </mp-sticky>
  </view>
</view>

<!-- 分割线 -->
<view style="height: 5px;background-color: gainsboro;"></view>

<view wx:if="{{emptyDatabase}}" style="text-align:center;margin-top:rpx;font-size:smaller;color:gray">* 记下我的第一笔账 *
</view>

<view wx:if="{{emptyYearPagee}}" style="text-align:center;margin-top:rpx;font-size:smaller;color:gray">* 这一年没有记账数据 *
</view>
<view wx:if="{{!haveGetOpenId}}" style="text-align:center;margin-top:rpx;font-size:smaller;color:gray">* 登录开启记账生活 *
</view>

<mp-cells ext-class="cellsStyle" title="{{months[index]}}月"
  footer="本月支出:{{monthsCost[months[index]-1]}}    本月收入:{{monthsIncome[months[index]-1]}}" wx:for="{{months}}"
  wx:key="index" wx:for-item="monNum">

  <mp-slideview buttons="{{slideButtons}}" wx:for="{{a_year_bill_data_Arr[monNum-1]}}" wx:key="index"
    bindbuttontap="slideButtonTap" id="{{item._id}}">
    <view class="cellStyle">
      <view style="display: flex;flex-direction: row;justify-content: space-around;margin-left: 20rpx;">
        <view style="width: 100rpx;">{{item.day}}日</view>
        <view style="flex-grow: 1;text-align: center;">{{item.type}}</view>
        <view
          style='width: 150rpx;text-align: right;margin-right: 20rpx;color: {{item.coi=="cost"?"#5095ED":"#34EBB5"}};'>
          {{item.coi=="cost"?"-":"+"}}{{item.money}}</view>
      </view>
      <view style="font-size: 30rpx;color: gray;margin-left:20rpx ; ">{{item.remark==""?"(无备注)":"备注："}}{{item.remark}}
      </view>
      <!-- ************************************修改操作表单*********************** -->
      <view wx:if="{{id_showModForm==item._id}}">
        <form bindsubmit="formSubmit_updateBill">
          <!-- 金额栏 -->
          <view>
            <view class="titleHeader">修改金额</view>
            <input name="money_m" class="inputBox" type="digit" placeholder="修改金额.." value="{{initInput_m_money}}" />
          </view>
          <!-- 备注栏 -->
          <view>
            <view class="titleHeader">修改备注</view>
            <input name="remark_m" class="inputBox" placeholder="输入新的备注" value="{{initInput_m_remarks}}" />
          </view>
          <!-- 按钮 -->
          <view class="HContainer" style="padding-left:20rpx;padding-top: 20rpx;padding-bottom: 20rpx;">
            <button class="formBtn_m" form-type="submit">确定</button>
            <button class="formBtn_m" style="margin: 10rpx 20rpx;" bindtap="cancelMod">取消</button>
          </view>
        </form>
      </view>
      <!-- ************************************删除确认表单*********************** -->
      <view wx:if="{{id_showDelForm==item._id}}">
        <form bindsubmit="formSubmit_DeleteBill">
        <!-- 按钮 -->
        <view class="HContainer" style="padding-left:20rpx;padding-top: 20rpx;padding-bottom: 20rpx;">
            <button class="formBtn_d" form-type="submit">确定删除</button>
            <button class="formBtn_d" style="margin: 10rpx 20rpx;" bindtap="cancelDel">取消</button>
          </view>
        </form>
      </view>

    </view>
  </mp-slideview>
</mp-cells>





<!-- ************************* ************         假页wxml       ************ ********************************* -->
<page-container show="{{show}}" round="{{round}}" overlay="{{overlay}}" duration="{{duration}}" position="{{position}}"
  close-on-slide-down="{{false}}" bindbeforeleave="onBeforeLeave" custom-style="{{customStyle}}"
  overlay-style="{{overlayStyle}}">
  <view style="background-color: #ABD9FF;">

    <!-- 日期栏 -->
    <view class="titleHeader">日期</view>
    <view>
      <picker mode="date" value="{{date}}" start="2000-07-14" end="{{today}}" bindchange="bindDateChange">
        <view style="display: flex;">
          <view style="flex-grow: 4;margin-left: 20rpx;font-weight: bold;">
            {{date}}</view>
          <view
            style="flex-grow: 0.5;background-color: #85d6ff;margin-right: 20rpx;border:3px solid #009CE9;border-radius:10px;text-align: center;font-size: smaller;color: #009CE9;font-weight: bolder;"
            wx:if="{{date==today}}">今天</view>
        </view>
      </picker>
    </view>

    <!-- 收支栏 -->
    <view class="titleHeader">收支</view>
    <view class="HContainer">
      <button bindtap="selCost"
        style='background-color: {{costOrIncome=="cost"? "#009CE9" : "white" }};margin: 0 20rpx;'>支出</button>
      <button bindtap="selIncome"
        style='background-color: {{costOrIncome=="income"? "#009CE9" : "white" }};margin: 0 20rpx;'>收入</button>
    </view>

    <!-- 类别栏 -->
    <view class="titleHeader">类别</view>
    <view class="typeBox" wx:if='{{costOrIncome=="cost"}}'>
      <button class="typeBtn" bindtap="selCostType" wx:for="{{costTypeList}}" wx:key="index" wx:for-item="ct"
        id="{{ct.sym}}" style='background-color: {{costType== ct.sym ? "#009CE9" : "white" }};margin: 0 20rpx;'>
        {{ct.name}}</button>
    </view>
    <view class="typeBox" wx:else>
      <button class="typeBtn" bindtap="selIncomeType" wx:for="{{incomeTypeList}}" wx:key="index" wx:for-item="ic"
        style='background-color: {{incomeType==ic.sym? "#009CE9" : "white" }};margin: 0 20rpx;'
        id="{{ic.sym}}">{{ic.name}}</button>
    </view>

    <!-- 表单包含：金额栏和备注栏 -->
    <form bindsubmit="formSubmit">
      <!-- 金额栏 -->
      <view>
        <view class="titleHeader">金额</view>
        <input name="money" class="inputBox" type="digit" placeholder="请输入金额" value="{{initInput}}" />
      </view>
      <!-- 备注栏 -->
      <view>
        <view class="titleHeader">备注</view>
        <input name="remark" class="inputBox" placeholder="请输入备注" value="{{initInput}}" />
      </view>
      <!-- 表单按钮 -->
      <view class="HContainer" style="padding-left:20rpx;padding-top: 60rpx;padding-bottom: 20rpx;">
        <button class="formBtn" form-type="submit">确定</button>
        <button class="formBtn" style="margin: 10rpx 20rpx;" bindtap="exitPage">取消</button>
      </view>
    </form>
  </view>
</page-container>